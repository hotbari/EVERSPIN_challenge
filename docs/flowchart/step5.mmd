flowchart TD
  A["/step5 요청"] --> B["clientIP, x-session-id, x-client-token 추출"]
  B --> C{"세션 없음/유효하지 않음?"}
  C -- 예 --> D["새 세션 생성, 헤더에 세션/토큰 반환, 실패 응답"]
  C -- 아니오 --> E["세션 만료(30분 초과)?" ]
  E -- 예 --> F["세션 삭제, 실패 응답"]
  E -- 아니오 --> G{"토큰 불일치/없음?"}
  G -- 예 --> H["실패 응답: 잘못된 요청"]
  G -- 아니오 --> I["요청 횟수 100회 초과?" ]
  I -- 예 --> J["세션 삭제, 실패 응답"]
  I -- 아니오 --> K["요청 간격 0.5초 미만?" ]
  K -- 예 --> L["실패 응답: 요청 너무 빠름"]
  K -- 아니오 --> M["세션 갱신, 새 토큰 발급, 통과"] 